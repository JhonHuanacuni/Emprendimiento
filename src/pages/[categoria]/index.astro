---
import Layout from "../../layouts/Layout.astro";
import productosJson from "../../data/productos.json";
import { generarSlug } from "../../utils/slug"; // ðŸ“Œ Importamos la funciÃ³n de slug

// ðŸ“Œ Definir la interfaz para los productos
interface Producto {
  nombre: string;
  descripcion: string;
}

// ðŸ“Œ Generar rutas estÃ¡ticas para categorÃ­as
export async function getStaticPaths() {
  return Object.keys(productosJson).map((categoria) => ({
    params: { categoria }
  }));
}

// ðŸ“Œ Obtener la categorÃ­a desde la URL
const { categoria } = Astro.params as { categoria?: string };

// ðŸ“Œ Verificar que la categorÃ­a existe en productosJson antes de acceder a sus datos
const productos: Producto[] = categoria && productosJson[categoria as keyof typeof productosJson] 
  ? productosJson[categoria as keyof typeof productosJson] 
  : [];
---

<Layout>
  <h1 class="text-3xl font-bold text-center my-6 capitalize">
    {categoria ?? "CategorÃ­a no encontrada"}
  </h1>

  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 px-4">
    {productos.length > 0
      ? productos.map((producto) => {
          // ðŸ“Œ Usar la funciÃ³n `generarSlug()` para crear la URL del producto
          const slug = generarSlug(producto.nombre);

          return (
            <a href={`/${categoria}/${slug}`} class="block bg-white p-6 rounded-lg shadow-md hover:shadow-xl transition transform hover:scale-105">
              <h2 class="text-xl font-semibold">{producto.nombre}</h2>
              <p class="text-gray-600">{producto.descripcion}</p>
            </a>
          );
        })
      : <p class="text-center text-gray-500">No hay productos en esta categorÃ­a.</p>
    }
  </div>
</Layout>
