---
import Layout from "../../../layouts/Layout.astro";
import productosJson from "../../../data/productos.json";
import { generarSlug } from "../../../utils/slug"; // 📌 Importamos la función para generar slugs

// 📌 Función para generar rutas estáticas
export async function getStaticPaths() {
  let paths: { params: { categoria: string; producto: string } }[] = [];

  // Recorremos todas las categorías y productos
  Object.entries(productosJson).forEach(([categoria, productos]) => {
    (productos as { nombre: string }[]).forEach((producto) => {
      const slug = generarSlug(producto.nombre); // 📌 Generamos el slug correctamente
      paths.push({ params: { categoria, producto: slug } });
    });
  });

  return paths;
}

// 📌 Obtener la categoría y el producto desde la URL (sin `as` cast)
const { categoria, producto } = Astro.params;

// 📌 Verificar que la categoría existe y obtener sus productos
const productos = categoria && categoria in productosJson
  ? productosJson[categoria as keyof typeof productosJson]
  : [];

// 📌 Buscar el producto comparando el slug generado con el slug de la URL
const productoSeleccionado = productos.find(
  (p) => generarSlug(p.nombre) === producto
);
---

<Layout>
  <section
    class="min-h-screen flex flex-col items-center justify-center bg-gradient-to-r from-purple-600 via-pink-500 to-red-500 text-white p-10 text-center"
  >
    {
      productoSeleccionado ? (
        <>
          <h1 class="text-6xl font-extrabold animate-pulse">
            🎉 {productoSeleccionado.nombre.toUpperCase()} 🎉
          </h1>
          <p class="mt-6 text-2xl italic max-w-2xl">
            {productoSeleccionado.descripcion}
          </p>

          <a
            href={productoSeleccionado.link}
            target="_blank"
            class="mt-8 bg-yellow-400 hover:bg-yellow-300 text-black font-bold py-4 px-8 rounded-full text-xl shadow-lg transition transform hover:scale-110"
          >
            🚀 ¡Cómpralo ahora!
          </a>

          <div class="mt-10 p-6 bg-white text-black rounded-lg shadow-lg">
            <h2 class="text-4xl font-bold">🔥 Oferta exclusiva 🔥</h2>
            <p class="text-xl mt-2">
              Este producto es de los más vendidos en {categoria}.
            </p>
          </div>
        </>
      ) : (
        <h2 class="text-4xl font-bold text-white">❌ Producto no encontrado</h2>
      )
    }
  </section>
</Layout>
