---
import Layout from "../../../layouts/Layout.astro";
import productosJson from "../../../data/productos.json";
import { generarSlug } from "../../../utils/slug"; // 游늷 Importamos la funci칩n para generar slugs


// Importar componentes espec칤ficos
import LibroDetalles from "../../../components/categorias/LibroDetalles.astro";
import ProductoGeneral from "../../../components/ProductoGeneral.astro";



const componentesPorCategoria: Record<string, (_props: Record<string, any>) => any> = {
  Libros: LibroDetalles,
  // Si deseas agregar componentes espec칤ficos para otras categor칤as, agr칠galos aqu칤:
  // belleza: BellezaDetalles,
  // deporte: DeporteDetalles,
  // moda: ModaDetalles,
  // tecnologia: TecnologiaDetalles,
  // hogar: HogarDetalles,
};

// 游늷 Funci칩n para generar rutas est치ticas
export async function getStaticPaths() {
  let paths: { params: { categoria: string; producto: string } }[] = [];

  // Recorremos todas las categor칤as y productos
  Object.entries(productosJson).forEach(([categoria, productos]) => {
    (productos as { nombre: string }[]).forEach((producto) => {
      const slug = generarSlug(producto.nombre); // 游늷 Generamos el slug correctamente
      paths.push({ params: { categoria, producto: slug } });
    });
  });

  return paths;
}

// 游늷 Obtener la categor칤a y el producto desde la URL (sin `as` cast)
const { categoria, producto } = Astro.params;

// 游늷 Verificar que la categor칤a existe y obtener sus productos
const productos = categoria && categoria in productosJson
  ? productosJson[categoria as keyof typeof productosJson]
  : [];

// 游늷 Buscar el producto comparando el slug generado con el slug de la URL
const productoSeleccionado = productos.find(
  (p) => generarSlug(p.nombre) === producto
);

// Elegir componente adecuado seg칰n categor칤a
const ComponenteDetalles = componentesPorCategoria[categoria as string] || ProductoGeneral;

---

<Layout>
  <div class="container mx-auto px-4 py-10">
    <div class="flex flex-col md:flex-row gap-8">

      <!-- Imagen del Producto (Optimizada) -->
<!--       <div class="md:w-1/2 w-full">
        <img
          src={Array.isArray(productoSeleccionado?.img) ? productoSeleccionado.img[0] : productoSeleccionado?.img}
          alt={productoSeleccionado?.nombre}
          class="w-full h-full max-h-[600px] object-cover rounded-xl shadow-xl"
        />
      </div> -->

      <!-- Detalles din치micos seg칰n categor칤a -->
      <div class="md:w-2/3">
        <p class="text-sm text-gray-500 uppercase">Categor칤a: {categoria}</p>
        <h1 class="text-3xl font-bold text-gray-800 mt-2 mb-4">
          {productoSeleccionado?.nombre}
        </h1>

        <!-- Aqu칤 se renderiza din치micamente el componente seg칰n categor칤a -->
        <ComponenteDetalles producto={productoSeleccionado} />

        <!-- Descripci칩n com칰n para todas las categor칤as -->
        </div>
      </div>

    </div>
  </div>
</Layout>
