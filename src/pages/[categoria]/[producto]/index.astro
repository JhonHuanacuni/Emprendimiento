---
import Layout from "../../../layouts/Layout.astro";
import productosJson from "../../../data/productos.json";
import { generarSlug } from "../../../utils/slug"; // 📌 Importamos la función para generar slugs

// 📌 Función para generar rutas estáticas
export async function getStaticPaths() {
  let paths: { params: { categoria: string; producto: string } }[] = [];

  // Recorremos todas las categorías y productos
  Object.entries(productosJson).forEach(([categoria, productos]) => {
    (productos as { nombre: string }[]).forEach((producto) => {
      const slug = generarSlug(producto.nombre); // 📌 Generamos el slug correctamente
      paths.push({ params: { categoria, producto: slug } });
    });
  });

  return paths;
}

// 📌 Obtener la categoría y el producto desde la URL (sin `as` cast)
const { categoria, producto } = Astro.params;

// 📌 Verificar que la categoría existe y obtener sus productos
const productos = categoria && categoria in productosJson
  ? productosJson[categoria as keyof typeof productosJson]
  : [];

// 📌 Buscar el producto comparando el slug generado con el slug de la URL
const productoSeleccionado = productos.find(
  (p) => generarSlug(p.nombre) === producto
);
---

<Layout>
  <div class="container mx-auto px-4 py-8 flex flex-col md:flex-row gap-8">
    <!-- Imagen del Producto -->
    <div class="w-full md:w-1/2">
      <img src={productoSeleccionado?.link[1]} alt={productoSeleccionado?.nombre} class="w-full rounded-lg shadow-md" />
    </div>

    <!-- Detalles del productoSeleccionado -->
    <div class="w-full md:w-1/2">
      <p class="text-sm text-gray-500">Categorías > Velas Coleccionables</p>
      <h1 class="text-3xl font-bold mt-2">{productoSeleccionado?.nombre}</h1>
      <p class="text-xl text-red-500 font-semibold mt-1">${productoSeleccionado?.nombre} {productoSeleccionado?.nombre}</p>

      <!-- Selector de Aroma -->
      <div class="mt-4">
        <label for="aroma" class="block font-semibold">Aroma</label>
        <select id="aroma" class="w-full border rounded-md p-2 mt-1">
          <option>Selecciona Aroma</option>
          <option>Vainilla</option>
          <option>Lavanda</option>
          <option>Canela</option>
        </select>
      </div>

      <!-- Botón -->
      <button class="w-full bg-gray-300 text-gray-700 font-semibold py-2 px-4 rounded-md mt-4">
        Selecciona Aroma
      </button>

      <!-- Stock -->
      <p class="text-red-600 font-bold mt-2">Quedan solo {productoSeleccionado?.nombre} unidades</p>

      <!-- Descripción -->
      <div class="mt-4">
        <h2 class="text-lg font-bold">Descripción</h2>
        <p class="text-gray-700 mt-2">{productoSeleccionado?.nombre}</p>
      </div>
    </div>
  </div>
</Layout>
