---
import { categorias } from "@/data/categorias";

// Extraer los nombres de las categor√≠as
const iconosPorCategoria: Record<string, string> = {
  belleza: "üíÑ",
  deporte: "üèãÔ∏è‚Äç‚ôÇÔ∏è",
  hogar: "üè°",
  moda: "üëó",
  tecnologia: "üì±",
  libros: "üìö",
};

const Categorias = categorias.map((c) => {
  const nombre = c.nombre;
  const icono = iconosPorCategoria[nombre.toLowerCase()] || "üì¶";
  return { nombre, icono };
});
---

<ul class="flex flex-wrap justify-center gap-4 my-6">
  {
    Categorias.map(({ nombre, icono }) => (
      <li>
        <a
          href="#"
          class="flex items-center gap-2 px-5 py-3 rounded-lg bg-white border border-gray-200 shadow-md hover:shadow-lg hover:scale-105 transition-all duration-200 ease-in-out cursor-pointer categoria-btn text-gray-800 font-medium"
          data-categoria={nombre}
        >
          <span class="text-2xl">{icono}</span>
          <span class="text-base">{nombre}</span>
        </a>
      </li>
    ))
  }
</ul>

<div id="categoria-contenido" class="grid gap-6 grid-cols-1 sm:grid-cols-2 lg:grid-cols-3"></div>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const contenedor = document.getElementById("categoria-contenido") as HTMLElement;

    fetch("/data/productos.json")
      .then((res) => res.json())
      .then((categorias) => {
        const botones = document.querySelectorAll(".categoria-btn");

        botones.forEach((btn) => {
          btn.addEventListener("click", (e) => {
            e.preventDefault();
            const nombreCategoria = btn.getAttribute("data-categoria") || "";
            const categoria = categorias.find(
              (c: any) => c.nombre === nombreCategoria
            );

            contenedor.innerHTML = "";

            if (categoria && Array.isArray(categoria.productos)) {
              categoria.productos.forEach((producto: any) => {
                const slug = generarSlug(producto.nombre);
                const link = document.createElement("a");
                link.href = `/${nombreCategoria.toLowerCase()}/${slug}`;
                link.className = `
                  block bg-gradient-to-br from-white via-gray-50 to-gray-100
                  border border-gray-200 rounded-lg p-4
                  shadow hover:shadow-xl hover:scale-105
                  transition-all duration-200 ease-in-out
                  transform
                `;

                link.innerHTML = `
                  <h3 class="text-lg font-semibold mb-1 text-gray-800">${producto.nombre}</h3>
                  <p class="text-sm text-gray-600 mb-2">${producto.descripcion}</p>
                  <p class="text-sm font-medium text-green-600">Precio: $${producto.precio}</p>
                `;

                contenedor.appendChild(link);
              });
            } else {
              contenedor.textContent = "No hay productos en esta categor√≠a.";
            }
          });
        });

        // Mostrar la primera categor√≠a autom√°ticamente
        const primera = categorias[0];
        if (primera) {
          const primerBtn = document.querySelector<HTMLAnchorElement>(
            `[data-categoria="${primera.nombre}"]`
          );
          primerBtn?.click();
        }

        // Funci√≥n para generar slug
        function generarSlug(texto: string): string {
          return texto
            .toLowerCase()
            .normalize("NFD")
            .replace(/[\u0300-\u036f]/g, "") // Quitar tildes
            .replace(/[^\w\s-]/g, "") // Quitar s√≠mbolos
            .trim()
            .replace(/\s+/g, "-"); // Espacios por guiones
        }
      })
      .catch((err) => {
        console.error("Error al cargar productos:", err);
      });
  });
</script>
